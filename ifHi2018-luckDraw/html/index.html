<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta content="yes" name="apple-mobile-web-app-capable">
    <meta content="yes" name="apple-touch-fullscreen">
    <meta content="telephone=no,email=no" name="format-detection">
    <meta content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no" name="viewport">
    <!-- 这两个js文件必须先加载 -->
    <script src="../js/flexible.debug.js"></script>
    <script src="../js/flexible_css.debug.js"></script>
    <title>签到抽奖</title>
    <link rel="stylesheet" href="../css/Arthas_Rest.css">
    <link rel="stylesheet" href="../css/style.css">
</head>
<body>
<!--顶部logo slogan-->
<header class="cl">
    <img src="../images/logo.png" alt="西湖论坛logo" class="in-logo">
    <span class="in-slogan"></span>
    <a href="javascript:;" class="in-rule">规则</a>
</header>
<!--音乐符号&播放音乐-->
<div class="in-music-box">
    <div class="in-music">
        <div id="audio-btn" class="on">
            <audio src="../audio/SeeYouAgain.mp3" loop autoplay id="media" preload></audio>
        </div>
    </div>
</div>
<!--主形象背景-->
<div class="in-bg-box">
    <div class="in-main-bg">
        <div class="in-ribbon"></div>
    </div>
</div>
<!--活动内容区域-->
<div class="in-content-box">
    <div class="in-altogether cl">
        <div class="line"></div>
        <p>已有<span>99999</span>人参加活动sadfsadfasfdjasljflasj</p>
        <div class="line"></div>
    </div>
    <div class="in-personal cl">
        <div class="in-per-head">
            <img src="../images/head.jpg" alt="">
            <p><span>2</span>金币</p>
        </div>
        <div class="in-per-count">
            <p>累计签到：<span>0</span>天</p>
            <p>连续签到：<span>2</span>天</p>
        </div>
    </div>
    <div class="in-sign">
        <a href="javascript:;" class="in-sign-btn"></a>
        <div class="in-sign-ribbons"></div>
    </div>
    <div class="in-draw-box">
        <div class="in-draw-text">
            <p>还需签到<span>3</span>天，可额外获得<span>93334</span>金币</p>
            <p>消耗<span>3293</span>金币可进行抽奖</p>
        </div>
        <button type="submit" class="in-draw-btn">立即抽奖</button>
    </div>
    <p class="in-support">页面技术由<strong>搜药</strong>提供</p>
</div>
<!--规则pop-->
<div class="pop-bg pop-rule-wrap">
    <div class="pop-rule-box">
        <ul class="pop-rule-nav cl">
            <li class="current">活动说明</li>
            <li class="">我的奖品</li>
        </ul>
        <ul class="pop-rule-content">
            <li>
                <div>
                    <dl>
                        <dt>活动奖品：</dt>
                        <dd>一等奖：拉德斯基放了假啊死了</dd>
                        <dd>二等奖：拉德斯基放了假啊死了</dd>
                        <dd>三等奖：拉德斯基放了假啊死了</dd>
                        <dd>四等奖：拉德斯基放了假啊死了</dd>
                        <dt>活动时间：</dt>
                        <dd>2017年2月30日--2019年13月32日</dd>
                        <dt>主办单位：</dt>
                        <dd>皓云集团</dd>
                        <dt>技术支持：</dt>
                        <dd>皓云集团皓云轩科技有限公司</dd>
                    </dl>
                </div>
            </li>
            <li>
                <div>
                    我是奖品
                </div>
            </li>
        </ul>
        <div class="pop-close pop-rule-close"></div>
    </div>
</div>
<!--抽奖弹窗-->
<div class="pop-bg pop-draw-wrap">
    <div class="pop-draw-box">
        <div class="pop-draw-content">
            <p>恭喜您所获的奖品为：西湖论坛门票一张</p>
            <div class="pop-draw-con-img">

            </div>
        </div>
        <div class="pop-draw-circle">
            <div class="pop-draw-bg">
                <div class="pop-draw-prize">

                </div>
                <div class="pop-draw-needle">

                </div>
            </div>
        </div>
        <div class="pop-close pop-draw-close"></div>
    </div>
</div>
</body>
<script src="../js/jquery-1.11.3.min.js"></script>
<script>


    /**
     * 音乐部分
     * @type {{changeClass: music.changeClass, play: music.play}}
     */
    musicPlay();

    function musicPlay() {
        var audio_btn = document.getElementById("audio-btn");
        audio_btn.onclick = function () {
            music.changeClass(this, "media");
        };
        var music = {
            changeClass: function (target, id) {
                var className = $(target).attr('class');
                var ids = document.getElementById(id);
                (className == 'on')
                    ? $(target).removeClass('on').addClass('off')
                    : $(target).removeClass('off').addClass('on');
                (className == 'on')
                    ? ids.pause()
                    : ids.play();
            },
            play: function () {
                document.getElementById('media').play();
            }
        };

        //ios 自动播放问题
        function audioAutoPlay(id) {
            var audio = document.getElementById(id),
                play = function () {
                    audio.play();
                    document.removeEventListener("touchstart", play, false);
                };
            audio.play();
            document.addEventListener("WeixinJSBridgeReady", function () {
                play();
            }, false);
            document.addEventListener('YixinJSBridgeReady', function () {
                play();
            }, false);
            document.addEventListener("touchstart", play, false);
        }

        audioAutoPlay('media');

        music.play();
    }

    /**
     * 规则与我的奖品界面的显示与隐藏
     */
    ruleOC();

    function ruleOC() {
        var rule_btn = document.querySelector(".in-rule");
        var pop_rule = document.querySelector(".pop-rule-wrap");
        var pop_close = document.querySelector(".pop-rule-close");

        var pop_nav = document.querySelector(".pop-rule-nav");
        var pop_ct = document.querySelector(".pop-rule-content");
        var pop_nav_lis = pop_nav.querySelectorAll("li");
        var pop_ct_lis = pop_ct.querySelectorAll("li");
        //引入函数传参数，打开关闭规则页面
        showHidePOP(rule_btn, pop_close, pop_rule);
        //切换活动说明和我的奖品
        for (var i = 0; i < pop_nav_lis.length; i++) {
            pop_nav_lis[i].index = i;
            pop_nav_lis[i].onclick = function () {

                for (var j in pop_nav_lis) {
                    pop_nav_lis[j].className = "";
                }
                for (var n = 0; n < pop_ct_lis.length; n++) {
                    pop_ct_lis[n].style.display = "none";
                }
                this.className = "current";
                pop_ct_lis[this.index].style.display = "block";
            };

        }
    }


    /**
     *立即抽奖弹出页面
     */
    drawPage();

    function drawPage() {
        //显示隐藏DOM
        var btn = document.querySelector(".in-draw-btn");
        var close = document.querySelector(".pop-draw-close");
        var pop_box = document.querySelector(".pop-draw-wrap");
        //抽奖需要DOM
        var start_draw = document.querySelector(".pop-draw-needle");
        var prize = document.querySelector(".pop-draw-prize");

        //引入函数，传参 ，显示隐藏抽奖页面
        showHidePOP(btn, close, pop_box);
        //点击立即抽奖，
        start_draw.onclick = function () {
            prize.style.transform = "rotate(0deg)";
            var num = Math.floor(Math.random() * 360) + 360 * 10;
            console.log(num);
            prize.style.transform = "rotate(" + num + "deg)";
            // console.log(prize);
        }

    }

    /**
     * 点击签到按钮签到彩带若隐若现
     * 点击签到按钮给按钮 a 标签的父级添加一个  complete  clss
     * 然后css 控制彩带闪烁，签到按钮换图片。
     * 签到按钮禁止点击。
     * 带第二天刷线，清除 class complete。
     */
    ribbonsShow();

    function ribbonsShow() {
        var sign_box = document.querySelector(".in-sign");
        var sign_btn = sign_box.querySelector(".in-sign-btn");
        sign_btn.onclick = function () {
            var sign_class = sign_box.className;
            sign_box.setAttribute("class", sign_class + " complete")
        }
    }

    /**
     *显示隐藏
     */

    function showHidePOP(show, close, obj) {
        show.onclick = function () {
            var n = 100;
            var timer = setInterval(function () {
                n -= 5;
                if (n == 0) {
                    clearInterval(timer);
                }
                obj.style.display = "block";
                obj.style.top = n + "%";
            }, 10);
        };
        close.onclick = function () {
            var n = 0;
            var timer = setInterval(function () {
                n -= 5;
                if (n == -100) {
                    clearInterval(timer);
                    obj.style.display = "none";
                }
                obj.style.top = n + "%";
            }, 10);
        };
    }

</script>
</html>
